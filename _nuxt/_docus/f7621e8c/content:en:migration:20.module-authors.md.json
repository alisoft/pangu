{"key":"content:en:migration:20.module-authors.md","generatedAt":"2022-07-12T12:13:00.841Z","mtime":"2022-07-12T12:13:00.827Z","slug":"module-authors","title":"Modules","position":"999900200000","to":"/migration/module-authors","draft":false,"page":true,"language":"en","head":{"title":"Nuxt 2 to Nuxt 3: Modules","titleTemplate":""},"empty":false,"description":"","body":{"raw":"---\nhead.title: 'Nuxt 2 to Nuxt 3: Modules'\nhead.titleTemplate: ''\n---\n\n# Modules\n\n## Module Compatibility\n\nNuxt 3 has a basic backward compatibility layer for Nuxt 2 modules using `@nuxt/kit` auto wrappers. But there are usually steps to follow to make modules compatible with Nuxt 3 and sometimes, using Nuxt Bridge is required for cross-version compatibility.\n\nWe have prepared a [Dedicated Guide](/guide/going-further/modules) for authoring Nuxt 3 ready modules using `@nuxt/kit`. Currently best migration path is to follow it and rewrite your modules. Rest of this guide includes preparation steps if you prefer to avoid a full rewrite yet making modules compatible with Nuxt 3.\n\n::alert\nYou can check for a list of Nuxt 3 ready modules from [Nuxt Modules](https://modules.nuxtjs.org/?version=3.x).\n::\n\n### Plugin Compatibility\n\nNuxt 3 plugins are **not** fully backward compatible with Nuxt 2.\n\n### Vue Compatibility\n\nPlugins or components using the Composition API need exclusive Vue 2 or Vue 3 support.\n\nBy using [vue-demi](https://github.com/vueuse/vue-demi) they should be compatible with both Nuxt 2 and 3.\n\n## Module Migration\n\nWhen Nuxt 3 users add your module, a compatible module container layer from `@nuxt/kit` is **automatically injected**, so as long as your code is following the guidelines below, it should continue working as-is.\n\n### Test with `@nuxt/bridge`\n\nMigrating to `@nuxt/bridge` is the first and most important step for supporting Nuxt 3.\n\nIf you have a fixture or example in your module, add `@nuxt/bridge` package to its config (see [example](/bridge#update-nuxtconfig))\n\n### Migrate from CommonJS to ESM\n\nNuxt 3 natively supports TypeScript and ECMAScript Modules. Please check [Native ES Modules](/guide/going-further/esm) for more info and upgrading.\n\n### Ensure plugins default export\n\nIf you inject a Nuxt plugin that does not have `export default` (such as global Vue plugins), ensure you add `export default () => { }` to the end of it.\n\n::code-group\n\n```js [Before]\n// ~/plugins/vuelidate.js\nimport Vue from 'vue'\nimport Vuelidate from 'vuelidate'\n\nVue.use(Vuelidate)\n```\n\n```js [After]\n// ~/plugins/vuelidate.js\nimport Vue from 'vue'\nimport Vuelidate from 'vuelidate'\n\nVue.use(Vuelidate)\n\nexport default () => { }\n```\n\n::\n\n### Avoid runtime modules\n\nWith Nuxt 3, Nuxt is now a build-time-only dependency, which means that modules shouldn't attempt to hook into the Nuxt runtime.\n\nYour module should work even if it's only added to [`buildModules`](/guide/directory-structure/nuxt.config#buildmodules) (instead of `modules`). For example:\n\n- Avoid updating `process.env` within a Nuxt module and reading by a nuxt plugin; use [`runtimeConfig`](/guide/directory-structure/nuxt.config#publicruntimeconfig) instead.\n- (*) Avoid depending on runtime hooks like `vue-renderer:*` for production\n- (*) Avoid adding `serverMiddleware` by importing them inside the module. Instead, add them by referencing a file path so that they are independent of the module's context\n\n(*) Unless it is for `nuxt dev` purpose only and guarded with `if (nuxt.options.dev) { }`.\n\n::alert{type=info icon=ðŸ”Ž}\nContinue reading about Nuxt 3 modules in the [Modules guide](/guide/going-further/modules).\n::\n\n### Use TypeScript (optional)\n\nWhile it is not essential, most of the Nuxt ecosystem is shifting to use TypeScript, so it is highly recommended to consider migration.\n\n::alert{icon=ðŸ’¡}\nYou can start migration by renaming `.js` files, to `.ts`. TypeScript is designed to be progressive!\n::\n\n::alert{icon=ðŸ’¡}\nYou can use TypeScript syntax for Nuxt 2 and 3 modules and plugins without any extra dependencies.\n::\n","ast":{"type":"root","children":[{"type":"element","tag":"prose-h1","props":{"class":"d-heading-title","id":"modules"},"children":[{"type":"text","value":"Modules"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"module-compatibility"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#module-compatibility"},"children":[{"type":"text","value":"Module Compatibility"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Nuxt 3 has a basic backward compatibility layer for Nuxt 2 modules using "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"@nuxt/kit"}]},{"type":"text","value":" auto wrappers. But there are usually steps to follow to make modules compatible with Nuxt 3 and sometimes, using Nuxt Bridge is required for cross-version compatibility."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"We have prepared a "},{"type":"element","tag":"prose-a","props":{"href":"/guide/going-further/modules"},"children":[{"type":"text","value":"Dedicated Guide"}]},{"type":"text","value":" for authoring Nuxt 3 ready modules using "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"@nuxt/kit"}]},{"type":"text","value":". Currently best migration path is to follow it and rewrite your modules. Rest of this guide includes preparation steps if you prefer to avoid a full rewrite yet making modules compatible with Nuxt 3."}]},{"type":"text","value":"\n"},{"type":"element","tag":"alert","props":{},"children":[{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"You can check for a list of Nuxt 3 ready modules from "},{"type":"element","tag":"prose-a","props":{"href":"https://modules.nuxtjs.org/?version=3.x","rel":["nofollow","noopener","noreferrer"],"target":"_blank"},"children":[{"type":"text","value":"Nuxt Modules"}]},{"type":"text","value":"."}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h3","props":{"id":"plugin-compatibility"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#plugin-compatibility"},"children":[{"type":"text","value":"Plugin Compatibility"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Nuxt 3 plugins are "},{"type":"element","tag":"prose-strong","props":{},"children":[{"type":"text","value":"not"}]},{"type":"text","value":" fully backward compatible with Nuxt 2."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h3","props":{"id":"vue-compatibility"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#vue-compatibility"},"children":[{"type":"text","value":"Vue Compatibility"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Plugins or components using the Composition API need exclusive Vue 2 or Vue 3 support."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"By using "},{"type":"element","tag":"prose-a","props":{"href":"https://github.com/vueuse/vue-demi","rel":["nofollow","noopener","noreferrer"],"target":"_blank"},"children":[{"type":"text","value":"vue-demi"}]},{"type":"text","value":" they should be compatible with both Nuxt 2 and 3."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"module-migration"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#module-migration"},"children":[{"type":"text","value":"Module Migration"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"When Nuxt 3 users add your module, a compatible module container layer from "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"@nuxt/kit"}]},{"type":"text","value":" is "},{"type":"element","tag":"prose-strong","props":{},"children":[{"type":"text","value":"automatically injected"}]},{"type":"text","value":", so as long as your code is following the guidelines below, it should continue working as-is."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h3","props":{"id":"test-with-nuxtbridge"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#test-with-nuxtbridge"},"children":[{"type":"text","value":"Test with "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"@nuxt/bridge"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Migrating to "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"@nuxt/bridge"}]},{"type":"text","value":" is the first and most important step for supporting Nuxt 3."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"If you have a fixture or example in your module, add "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"@nuxt/bridge"}]},{"type":"text","value":" package to its config (see "},{"type":"element","tag":"prose-a","props":{"href":"/bridge#update-nuxtconfig"},"children":[{"type":"text","value":"example"}]},{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h3","props":{"id":"migrate-from-commonjs-to-esm"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#migrate-from-commonjs-to-esm"},"children":[{"type":"text","value":"Migrate from CommonJS to ESM"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Nuxt 3 natively supports TypeScript and ECMAScript Modules. Please check "},{"type":"element","tag":"prose-a","props":{"href":"/guide/going-further/esm"},"children":[{"type":"text","value":"Native ES Modules"}]},{"type":"text","value":" for more info and upgrading."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h3","props":{"id":"ensure-plugins-default-export"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#ensure-plugins-default-export"},"children":[{"type":"text","value":"Ensure plugins default export"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"If you inject a Nuxt plugin that does not have "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"export default"}]},{"type":"text","value":" (such as global Vue plugins), ensure you add "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"export default () => { }"}]},{"type":"text","value":" to the end of it."}]},{"type":"text","value":"\n"},{"type":"element","tag":"code-group","props":{},"children":[{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"Before"}]},{"type":"element","tag":"pre","props":{"className":["language-js","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"// ~/plugins/vuelidate.js"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","imports"]},"children":[{"type":"element","tag":"span","props":{"className":["token","maybe-class-name"]},"children":[{"type":"text","value":"Vue"}]}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"from"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'vue'"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","imports"]},"children":[{"type":"element","tag":"span","props":{"className":["token","maybe-class-name"]},"children":[{"type":"text","value":"Vuelidate"}]}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"from"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'vuelidate'"}]},{"type":"text","value":"\n\n"},{"type":"element","tag":"span","props":{"className":["token","maybe-class-name"]},"children":[{"type":"text","value":"Vue"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"className":["token","method","function","property-access"]},"children":[{"type":"text","value":"use"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","maybe-class-name"]},"children":[{"type":"text","value":"Vuelidate"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"}]}]}]},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"After"}]},{"type":"element","tag":"pre","props":{"className":["language-js","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"// ~/plugins/vuelidate.js"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","imports"]},"children":[{"type":"element","tag":"span","props":{"className":["token","maybe-class-name"]},"children":[{"type":"text","value":"Vue"}]}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"from"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'vue'"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","imports"]},"children":[{"type":"element","tag":"span","props":{"className":["token","maybe-class-name"]},"children":[{"type":"text","value":"Vuelidate"}]}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"from"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'vuelidate'"}]},{"type":"text","value":"\n\n"},{"type":"element","tag":"span","props":{"className":["token","maybe-class-name"]},"children":[{"type":"text","value":"Vue"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"className":["token","method","function","property-access"]},"children":[{"type":"text","value":"use"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","maybe-class-name"]},"children":[{"type":"text","value":"Vuelidate"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n"},{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"export"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"default"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","arrow","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h3","props":{"id":"avoid-runtime-modules"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#avoid-runtime-modules"},"children":[{"type":"text","value":"Avoid runtime modules"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"With Nuxt 3, Nuxt is now a build-time-only dependency, which means that modules shouldn't attempt to hook into the Nuxt runtime."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Your module should work even if it's only added to "},{"type":"element","tag":"prose-a","props":{"href":"/guide/directory-structure/nuxt.config#buildmodules"},"children":[{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"buildModules"}]}]},{"type":"text","value":" (instead of "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"modules"}]},{"type":"text","value":"). For example:"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-ul","props":{},"children":[{"type":"text","value":"\n"},{"type":"element","tag":"prose-li","props":{},"children":[{"type":"text","value":"\n"},{"type":"text","value":"Avoid updating "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"process.env"}]},{"type":"text","value":" within a Nuxt module and reading by a nuxt plugin; use "},{"type":"element","tag":"prose-a","props":{"href":"/guide/directory-structure/nuxt.config#publicruntimeconfig"},"children":[{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"runtimeConfig"}]}]},{"type":"text","value":" instead."},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-li","props":{},"children":[{"type":"text","value":"\n"},{"type":"text","value":"(*) Avoid depending on runtime hooks like "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"vue-renderer:*"}]},{"type":"text","value":" for production"},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-li","props":{},"children":[{"type":"text","value":"\n"},{"type":"text","value":"(*) Avoid adding "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"serverMiddleware"}]},{"type":"text","value":" by importing them inside the module. Instead, add them by referencing a file path so that they are independent of the module's context"},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"(*) Unless it is for "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"nuxt dev"}]},{"type":"text","value":" purpose only and guarded with "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"if (nuxt.options.dev) { }"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tag":"alert","props":{"icon":"ðŸ”Ž","type":"info"},"children":[{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Continue reading about Nuxt 3 modules in the "},{"type":"element","tag":"prose-a","props":{"href":"/guide/going-further/modules"},"children":[{"type":"text","value":"Modules guide"}]},{"type":"text","value":"."}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h3","props":{"id":"use-typescript-optional"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#use-typescript-optional"},"children":[{"type":"text","value":"Use TypeScript (optional)"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"While it is not essential, most of the Nuxt ecosystem is shifting to use TypeScript, so it is highly recommended to consider migration."}]},{"type":"text","value":"\n"},{"type":"element","tag":"alert","props":{"icon":"ðŸ’¡"},"children":[{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"You can start migration by renaming "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":".js"}]},{"type":"text","value":" files, to "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":".ts"}]},{"type":"text","value":". TypeScript is designed to be progressive!"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"alert","props":{"icon":"ðŸ’¡"},"children":[{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"You can use TypeScript syntax for Nuxt 2 and 3 modules and plugins without any extra dependencies."}]}]}]},"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"module-compatibility","depth":2,"text":"Module Compatibility","children":[{"id":"plugin-compatibility","depth":3,"text":"Plugin Compatibility"},{"id":"vue-compatibility","depth":3,"text":"Vue Compatibility"}]},{"id":"module-migration","depth":2,"text":"Module Migration","children":[{"id":"test-with-nuxtbridge","depth":3,"text":"Test with @nuxt/bridge"},{"id":"migrate-from-commonjs-to-esm","depth":3,"text":"Migrate from CommonJS to ESM"},{"id":"ensure-plugins-default-export","depth":3,"text":"Ensure plugins default export"},{"id":"avoid-runtime-modules","depth":3,"text":"Avoid runtime modules"},{"id":"use-typescript-optional","depth":3,"text":"Use TypeScript (optional)"}]}]}}}