{"key":"content:en:2.guide:6.going-further:1.internals.md","generatedAt":"2022-07-13T14:42:27.804Z","mtime":"2022-07-13T14:42:27.788Z","slug":"internals","title":"How Nuxt Works?","position":"000200060001","to":"/guide/going-further/internals","draft":false,"page":true,"language":"en","empty":false,"description":"Nuxt is a minimal but highly customizable framework to build web applications. This guide helps you better understand Nuxt internals to develop new solutions and module integrations on top of Nuxt.","body":{"raw":"# How Nuxt Works?\n\nNuxt is a minimal but highly customizable framework to build web applications. This guide helps you better understand Nuxt internals to develop new solutions and module integrations on top of Nuxt.\n\n## The Nuxt interface\n\nWhen you start nuxt in development mode with `nuxi dev` or building a production application with `nuxi build`,\na common context will be created, referred to as `nuxt` internally. It holds normalized options merged with `nuxt.config` file,\nsome internal state, and a powerful [hooking system](/api/advanced/hooks) powered by [unjs/hookable](https://github.com/unjs/hookable)\nallowing different components to communicate with each other. You can think of it as **Builder Core**.\n\nThis context is globally available to be used with [nuxt/kit](/api/advanced/kit) composables.\nTherefore only one instance of Nuxt is allowed to run per process.\n\nTo extend the Nuxt interface and hook into different stages of the build process, we can use [Nuxt Modules](/guide/going-further/modules).\n\nFor more details, check out [the source code](https://github.com/nuxt/framework/blob/main/packages/nuxt/src/core/nuxt.ts).\n\n## The NuxtApp interface\n\nWhen rendering a page in the browser or on the server, a shared context will be created, referred to as `nuxtApp`.\nThis context keeps vue instance, runtime hooks, and internal states like ssrContext and payload for hydration.\nYou can think of it as **Runtime Core**.\n\nThis context can be accessed using `useNuxtApp()` composable within nuxt plugins and `<script setup>` and vue composables.\nGlobal usage is possible for the browser but not on the server, to avoid sharing context between users.\n\nTo extend the `nuxtApp` interface and hook into different stages or access contexts, we can use [Nuxt Plugins](/guide/directory-structure/plugins).\n\nCheck [Nuxt App](/api/composables/use-nuxt-app) for more information about this interface.\n\n`nuxtApp` has the following properties:\n\nNote: this is an internal interface, and some properties might change until stable release.\n\n```js\nconst nuxtApp = {\n  vueApp, // the global Vue application: https://vuejs.org/api/application.html#application-api\n\n  // These let you call and add runtime NuxtApp hooks\n  // https://github.com/nuxt/framework/blob/main/packages/nuxt/src/app/nuxt.ts#L18\n  hooks,\n  hook,\n  callHook,\n\n  // Only accessible on server-side\n  ssrContext: {\n    url,\n    req,\n    res,\n    runtimeConfig,\n    noSSR,\n  },\n\n  // This will be stringified and passed from server to client\n  payload: {\n    serverRendered: true,\n    data: {},\n    state: {}\n  }\n\n  provide: (name: string, value: any) => void\n}\n```\n\nFor more details, check out [the source code](https://github.com/nuxt/framework/blob/main/packages/nuxt/src/app/nuxt.ts).\n\n## Runtime Context vs. Build Context\n\nNuxt builds and bundles project using Node.js but also has a runtime side.\n\nWhile both areas can be extended, that runtime context is isolated from build-time. Therefore, they are not supposed to share state, code, or context other than runtime configuration!\n\n`nuxt.config` and [Nuxt Modules](/guide/going-further/modules) can be used to extend the build context, and [Nuxt Plugins](/guide/directory-structure/plugins) can be used to extend runtime.\n\nWhen building an application for production, `nuxi build` will generate a standalone build\n in the `.output` directory, independent of `nuxt.config` and [Nuxt modules](/guide/going-further/modules).\n","ast":{"type":"root","children":[{"type":"element","tag":"prose-h1","props":{"class":"d-heading-title","id":"how-nuxt-works"},"children":[{"type":"text","value":"How Nuxt Works?"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{"class":"d-heading-description"},"children":[{"type":"text","value":"Nuxt is a minimal but highly customizable framework to build web applications. This guide helps you better understand Nuxt internals to develop new solutions and module integrations on top of Nuxt."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"the-nuxt-interface"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#the-nuxt-interface"},"children":[{"type":"text","value":"The Nuxt interface"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"When you start nuxt in development mode with "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"nuxi dev"}]},{"type":"text","value":" or building a production application with "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"nuxi build"}]},{"type":"text","value":",\na common context will be created, referred to as "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"nuxt"}]},{"type":"text","value":" internally. It holds normalized options merged with "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"nuxt.config"}]},{"type":"text","value":" file,\nsome internal state, and a powerful "},{"type":"element","tag":"prose-a","props":{"href":"/api/advanced/hooks"},"children":[{"type":"text","value":"hooking system"}]},{"type":"text","value":" powered by "},{"type":"element","tag":"prose-a","props":{"href":"https://github.com/unjs/hookable","rel":["nofollow","noopener","noreferrer"],"target":"_blank"},"children":[{"type":"text","value":"unjs/hookable"}]},{"type":"text","value":"\nallowing different components to communicate with each other. You can think of it as "},{"type":"element","tag":"prose-strong","props":{},"children":[{"type":"text","value":"Builder Core"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"This context is globally available to be used with "},{"type":"element","tag":"prose-a","props":{"href":"/api/advanced/kit"},"children":[{"type":"text","value":"nuxt/kit"}]},{"type":"text","value":" composables.\nTherefore only one instance of Nuxt is allowed to run per process."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"To extend the Nuxt interface and hook into different stages of the build process, we can use "},{"type":"element","tag":"prose-a","props":{"href":"/guide/going-further/modules"},"children":[{"type":"text","value":"Nuxt Modules"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"For more details, check out "},{"type":"element","tag":"prose-a","props":{"href":"https://github.com/nuxt/framework/blob/main/packages/nuxt/src/core/nuxt.ts","rel":["nofollow","noopener","noreferrer"],"target":"_blank"},"children":[{"type":"text","value":"the source code"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"the-nuxtapp-interface"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#the-nuxtapp-interface"},"children":[{"type":"text","value":"The NuxtApp interface"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"When rendering a page in the browser or on the server, a shared context will be created, referred to as "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"nuxtApp"}]},{"type":"text","value":".\nThis context keeps vue instance, runtime hooks, and internal states like ssrContext and payload for hydration.\nYou can think of it as "},{"type":"element","tag":"prose-strong","props":{},"children":[{"type":"text","value":"Runtime Core"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"This context can be accessed using "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"useNuxtApp()"}]},{"type":"text","value":" composable within nuxt plugins and "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"<script setup>"}]},{"type":"text","value":" and vue composables.\nGlobal usage is possible for the browser but not on the server, to avoid sharing context between users."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"To extend the "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"nuxtApp"}]},{"type":"text","value":" interface and hook into different stages or access contexts, we can use "},{"type":"element","tag":"prose-a","props":{"href":"/guide/directory-structure/plugins"},"children":[{"type":"text","value":"Nuxt Plugins"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Check "},{"type":"element","tag":"prose-a","props":{"href":"/api/composables/use-nuxt-app"},"children":[{"type":"text","value":"Nuxt App"}]},{"type":"text","value":" for more information about this interface."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"nuxtApp"}]},{"type":"text","value":" has the following properties:"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Note: this is an internal interface, and some properties might change until stable release."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"pre","props":{"className":["language-js","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" nuxtApp "},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  vueApp"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"// the global Vue application: https://vuejs.org/api/application.html#application-api"}]},{"type":"text","value":"\n\n  "},{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"// These let you call and add runtime NuxtApp hooks"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"// https://github.com/nuxt/framework/blob/main/packages/nuxt/src/app/nuxt.ts#L18"}]},{"type":"text","value":"\n  hooks"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n  hook"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n  callHook"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n\n  "},{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"// Only accessible on server-side"}]},{"type":"text","value":"\n  ssrContext"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    url"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n    req"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n    res"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n    runtimeConfig"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n    noSSR"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n  "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n\n  "},{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"// This will be stringified and passed from server to client"}]},{"type":"text","value":"\n  payload"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    serverRendered"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","boolean"]},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n    data"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n    state"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n  "},{"type":"element","tag":"span","props":{"className":["token","function-variable","function"]},"children":[{"type":"text","value":"provide"}]},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","parameter"]},"children":[{"type":"text","value":"name"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" string"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" value"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" any"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","arrow","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","keyword"]},"children":[{"type":"text","value":"void"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"For more details, check out "},{"type":"element","tag":"prose-a","props":{"href":"https://github.com/nuxt/framework/blob/main/packages/nuxt/src/app/nuxt.ts","rel":["nofollow","noopener","noreferrer"],"target":"_blank"},"children":[{"type":"text","value":"the source code"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"runtime-context-vs-build-context"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#runtime-context-vs-build-context"},"children":[{"type":"text","value":"Runtime Context vs. Build Context"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Nuxt builds and bundles project using Node.js but also has a runtime side."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"While both areas can be extended, that runtime context is isolated from build-time. Therefore, they are not supposed to share state, code, or context other than runtime configuration!"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"nuxt.config"}]},{"type":"text","value":" and "},{"type":"element","tag":"prose-a","props":{"href":"/guide/going-further/modules"},"children":[{"type":"text","value":"Nuxt Modules"}]},{"type":"text","value":" can be used to extend the build context, and "},{"type":"element","tag":"prose-a","props":{"href":"/guide/directory-structure/plugins"},"children":[{"type":"text","value":"Nuxt Plugins"}]},{"type":"text","value":" can be used to extend runtime."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"When building an application for production, "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"nuxi build"}]},{"type":"text","value":" will generate a standalone build\nin the "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":".output"}]},{"type":"text","value":" directory, independent of "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"nuxt.config"}]},{"type":"text","value":" and "},{"type":"element","tag":"prose-a","props":{"href":"/guide/going-further/modules"},"children":[{"type":"text","value":"Nuxt modules"}]},{"type":"text","value":"."}]}]},"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"the-nuxt-interface","depth":2,"text":"The Nuxt interface"},{"id":"the-nuxtapp-interface","depth":2,"text":"The NuxtApp interface"},{"id":"runtime-context-vs-build-context","depth":2,"text":"Runtime Context vs. Build Context"}]}}}